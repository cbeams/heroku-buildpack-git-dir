#!/bin/sh


set -x
ENV_DIR=${3:-}
heroku_git_username="$(cat $ENV_DIR/HEROKU_GIT_USERNAME)"; set +x
heroku_git_password="$(cat $ENV_DIR/HEROKU_GIT_PASSWORD)"; set -x
heroku_app_name="$(cat $ENV_DIR/HEROKU_APP_NAME)"
heroku_slug_commit="$(cat $ENV_DIR/HEROKU_SLUG_COMMIT)"

echo "HERE"
echo $1
echo "THERE"

echo "test" > afile

cat afile

touch $1/foobar1
ls -l $1/foobar1

#echo "machine git.heroku.com" > $1/.netrc; set +x
#echo "  password $heroku_git_password" >> $1/.netrc; set -x
#echo "  login $heroku_git_username" >> $1/.netrc

git clone https://git.heroku.com/$heroku_app_name.git temp_git_clone_dir

git -C temp_git_clone_dir checkout $heroku_slug_commit

mkdir $1/.git
cp -r temp_git_clone_dir/.git/* $1/.git

# Debug
git -C $1 status

rm -rf temp_git_clone_dir
