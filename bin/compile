#!/bin/sh


set -x
ENV_DIR=${3:-}
netrc_heroku_login="$(cat $ENV_DIR/NETRC_HEROKU_LOGIN)"; set +x
netrc_heroku_password="$(cat $ENV_DIR/NETRC_HEROKU_PASSWORD)"; set -x
heroku_app_name="$(cat $ENV_DIR/HEROKU_APP_NAME)"

cat > $HOME/.netrc <<EOM
machine git.heroku.com
  password $netrc_heroku_password
  login $netrc_heroku_login
EOM

git clone https://git.heroku.com/$heroku_app_name.git temp_git_clone_dir

git -C temp_git_clone_dir checkout $SOURCE_VERSION

rm -rf $1/.git
mkdir $1/.git
cp -r temp_git_clone_dir/.git/* $1/.git

# Debug
git -C $1 status

rm -rf temp_git_clone_dir
